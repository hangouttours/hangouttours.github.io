<?xml version="1.0" encoding="UTF-8" ?>
<Module>
<!-- Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *      
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License
-->
  <ModulePrefs title="Hangout Starter">
    <Require feature="rpc" />
    <Require feature="views" />
    <Require feature="locked-domain" />
  </ModulePrefs>
  <Content type="html"><![CDATA[     
<html>
  <head>   
    <script type="text/javascript"
      src="//maps.googleapis.com/maps/api/js?key=AIzaSyAqwwIT8aSIQ03hXvYlXzOvRZ08Rv7LWDQ&sensor=false"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/1.1.0/annyang.min.js"></script>
    <script src="//plus.google.com/hangouts/_/api/v1/hangout.js"></script>
    <script src="//connect.soundcloud.com/sdk.js"></script>
    <script src="//w.soundcloud.com/player/api.js"></script>
    <link href="//fonts.googleapis.com/css?family=Lato" rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//hangouttours.github.io/css/app.css" />
    <style type="text/css">
      html, body { background: #181818 }
      body { color: #efefef; font-size: 14pt; font-family: "Lato", "Helvetica Neue", "Helvetica", sans-serif; width: 95%; margin: 10px auto; }
      #main { overflow: auto; }
    </style>
  </head>
  <body onload="initialize()">
    <div id="main">
      <h1>Hangout Tours</h1>
      <div id="map_canvas1" style="width: 650px; height: 400px; float: left;"></div> 
      <div id="space" style="width=10px; height: 400px; float: left;">&nbsp;</div> 
      <div id="map_canvas2" style="width: 650px; height: 400px; float: left;"></div>
    </div>
    <br>
    <footer>-----<br>Hacked by <a href="//twitter.com/whatmariel">@whatmariel</a> and <a href="//twitter.com/tylerbabich">@tylerbabich</a> at HackDuke</footer>

    <script type="text/javascript">
      var map;
      var panorama;
      var panoramaOptions;
      var hangout = true;
    
      // the function called when the page loads; it shows the map and street view
      function initialize() {
        // coordinates for the center of the map
        var mapCenter = new google.maps.LatLng(39.286704,-76.608411);
        // options for the map
        var mapOptions = {
          center: mapCenter,
          zoom: 15,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          streetViewControl: true
        };
        // create a new map object to be shown in the map_canvas1 div elements and with the options that were set
        map = new google.maps.Map(document.getElementById("map_canvas1"), mapOptions);
        
        // options for the panorama
        panoramaOptions = {
          addressControl: true,
          addressControlOptions: {
            style: {backgroundColor: 'grey', color: 'yellow'}
          },
          position: mapCenter,
          pov: {
            heading: 140,
            pitch: +10,
            zoom: 1
          }
        };
        // show the panorama in the map_canvas2 div element with the options that were set
        panorama = new  google.maps.StreetViewPanorama(document.getElementById("map_canvas2"), panoramaOptions);
        // set street view for map
        map.setStreetView(panorama);
        
        // add marker for tour eiffel
          // on map
        var marker = new google.maps.Marker({
          position: mapCenter, 
          map: map, 
          title: "National Aquarium"
        });
        google.maps.event.addListener(marker, 'click', function() {
          if (hangout) { gapi.hangout.data.submitDelta({'mapPos' : marker.position}); }
          panorama.setPosition(marker.position);
          panorama.setPov({heading: 140, pitch: +10, zoom: 1});
        });
          // on panorama
        var markerPanorama = new google.maps.Marker({
            position: mapCenter,
            map: panorama,
            title: "National Aquarium"
         });

        // add notre dame marker
          // on map
        var positionLexington = new google.maps.LatLng(39.291499,-76.621061);
        var markerLexington = new google.maps.Marker({
          position: positionLexington, 
          map: map, 
          title: "Lexington Market"
        });
        // add listener to change panorama options when the marker is clicked
        google.maps.event.addListener(markerLexington, 'click', function() {
          if (hangout) { gapi.hangout.data.submitDelta({'mapPos' : positionLexington}); }
          panorama.setPosition(positionLexington);
          panorama.setPov({heading: 140, pitch: +10, zoom: 1});
        });
          // on panorama
        var markerLexingtonPanorama = new google.maps.Marker({
            position: positionLexington,
            map: panorama,
            title: "Lexington Market"
         });
        
        // add louvre marker
        var positionWalters = new google.maps.LatLng(39.296316,-76.6167789);
        var markerWalters = new google.maps.Marker({
          position: positionWalters, 
          map: map, 
          title:"Walters Art Museum"
        });
        // add listener to change panorama options when the marker is clicked
        google.maps.event.addListener(markerWalters, 'click', function() {
          if (hangout) { gapi.hangout.data.submitDelta({'mapPos' : positionWalters}); }
          panorama.setPosition(positionWalters);
          panorama.setPov({heading: 230, pitch: +10, zoom: 1});
        });
          // on panorama
        var markerWaltersPanorama = new google.maps.Marker({
            position: positionWalters,
            map: panorama,
            title: 'Walters Art Museum'
         });

        google.maps.event.addListener(panorama, 'position_changed', function() {
          console.log(panorama)
          if (hangout) { gapi.hangout.data.submitDelta({ 'mapPos' : positionWalters }); }
        });

        google.maps.event.addListener(panorama, 'pov_changed', function() {
          console.log(panorama);
          if (hangout) { 
            gapi.hangout.data.submitDelta({'heading' : panorama.getPov().heading.toString(), 'pitch' : panorama.getPov().pitch.toString() });
          }
        });
      }

      function changePosition(position) { 
          panorama.setPosition(position);
      }

      function changeHeading(heading) { 
          panorama.setPov({heading: parseInt(heading)});
      }

      function changePitch(pitch) { 
          panorama.setPov({pitch: parseInt(pitch)});
      }

      if (hangout) {
        gapi.hangout.data.onStateChanged.add(function(event) {
          console.log('state has changed!');
          console.log(event);
          if (gapi.hangout.data.getValue("mapPos") !== undefined) {
            changePosition(gapi.hangout.data.getValue("mapPos"));
            gapi.hangout.data.clearValue("mapPos");
          } else if (gapi.hangout.data.getValue("heading") !== undefined) {
            changePov(gapi.hangout.data.getValue("heading"));
            gapi.hangout.data.clearValue("heading");
          } else if (gapi.hangout.data.getValue("pitch") !== undefined) {
            changePov(gapi.hangout.data.getValue("pitch"));
            gapi.hangout.data.clearValue("pitch");
          }
        });
      }

    </script> 
  </body>
</html>
    ]]>
  </Content>
</Module>